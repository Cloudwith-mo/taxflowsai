<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TaxFlowsAI Dashboard</title>
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous"
  />
  <style>
    /* =======================
       GLOBAL & ROOT
       ======================= */
    :root {
      --bg: #0d1a2e;
      --card-bg: #1e2a44;
      --primary: #2979ff;
      --text: #e5e7eb;
      --muted: #8f98a5;
      --shadow: rgba(0,0,0,0.4);
    }
    * { box-sizing: border-box; margin:0; padding:0 }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: "Segoe UI", sans-serif;
    }
    .container { max-width:1200px; margin:auto; padding:2rem 1rem }

    /* =======================
       HEADER
       ======================= */
    .header {
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .header-left {
      display:flex;
      align-items:center;
      gap:.5rem;
    }
    .header-left i {
      font-size:2rem;
      color:var(--primary);
    }
    .header-left h1 {
      font-size:1.5rem;
      font-weight:500;
    }
    .header-left h1 span {
      color:var(--primary);
    }
    .header-right button {
      background:none;
      border:none;
      color:var(--muted);
      font-size:1.5rem;
      cursor:pointer;
    }
    .header-right button:hover {
      color:var(--text);
    }
    .divider {
      margin:1rem 0 2rem;
      height:1px;
      border:none;
      background:rgba(255,255,255,0.1);
    }

    /* =======================
       TOP SECTION
       ======================= */
    .top {
      display:flex;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:1rem;
    }
    .greeting {
      font-size:1.75rem;
      font-weight:500;
    }
    .subtext {
      font-size:.9rem;
      color:var(--muted);
      margin-top:.25rem;
    }
    .progress-tabs {
      display:flex;
      align-items:center;
      gap:1.5rem;
      position:relative;
      flex:1;
      max-width:400px;
    }
    .progress-tabs span {
      cursor:pointer;
      color:var(--muted);
      padding-bottom:.25rem;
      font-size:.9rem;
    }
    .progress-tabs span.active {
      color:var(--text);
      font-weight:500;
    }
    .progress-bar {
      position:absolute;
      bottom:0;
      height:3px;
      background:var(--primary);
      transition:left .3s, width .3s;
    }
    .btn-open-upload {
      background:var(--primary);
      color:#fff;
      border:none;
      padding:.75rem 1.25rem;
      border-radius:8px;
      cursor:pointer;
      font-size:.9rem;
    }
    .btn-open-upload:hover {
      opacity:.9;
    }

    /* =======================
       GRID & CARDS
       ======================= */
    .grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
      gap:1.5rem;
      margin-top:2rem;
    }
    .card {
      background:var(--card-bg);
      border-radius:12px;
      padding:1.25rem;
      box-shadow:0 4px 12px var(--shadow);
    }
    .card h3 {
      font-size:1.1rem;
      margin-bottom:1rem;
    }

    /* =======================
       DOCUMENT LIST
       ======================= */
    .doc-list {
      list-style:none;
      padding:0;
      margin:0;
    }
    .doc-list li {
      display:flex;
      align-items:center;
      gap:.75rem;
      padding:.5rem;
      border-radius:6px;
      cursor:pointer;
      transition:background .2s;
    }
    .doc-list li:hover {
      background:rgba(255,255,255,0.05);
    }
    .doc-list li i {
      font-size:1.5rem;
      color:var(--primary);
      min-width:1.5rem;
    }
    .tag-list {
      margin-top:.5rem;
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
    }
    .tag {
      background:var(--primary);
      color:#fff;
      padding:.25rem .5rem;
      border-radius:4px;
      font-size:.75rem;
    }

    /* =======================
       NOTIFICATIONS
       ======================= */
    .no-notifs {
      text-align:center;
      color:var(--muted);
      padding:1.5rem 0;
      font-size:.9rem;
    }

    /* =======================
       AI Chat
       ======================= */
    .chat-icon {
      text-align:center;
      margin-bottom:.75rem;
    }
    .chat-icon i {
      font-size:2.5rem;
      color:var(--primary);
    }
    .chat-quick {
      list-style:none;
      padding:0;
      margin:0 0 1rem;
    }
    .chat-quick li a {
      display:block;
      background:#0f243f;
      padding:.75rem 1rem;
      border-radius:8px;
      color:var(--text);
      text-decoration:none;
      font-size:.9rem;
      margin-bottom:.75rem;
      transition:background .2s;
    }
    .chat-quick li a:hover {
      background:#0d1f38;
    }
    .chat-input {
      display:flex;
      flex-direction:column;
      gap:.5rem;
    }
    .chat-input input {
      padding:.75rem 1rem;
      border:none;
      border-radius:8px;
      background:#0f243f;
      color:var(--text);
    }
    .chat-input button {
      background:var(--primary);
      border:none;
      border-radius:8px;
      padding:.75rem;
      color:#fff;
      cursor:pointer;
      transition:background .2s;
    }
    .chat-input button:hover {
      background:#1a73e8;
    }

    /* =======================
       MODALS
       ======================= */
    .modal-overlay {
      position:fixed;
      top:0; left:0;
      width:100vw; height:100vh;
      background:rgba(0,0,0,0.6);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:1000;
    }
    .modal-overlay.hidden {
      display:none;
    }
    .modal {
      background:var(--card-bg);
      border-radius:12px;
      padding:1.5rem;
      position:relative;
      box-shadow:0 8px 24px var(--shadow);
      max-height:90vh;
      overflow:auto;
    }
    .modal-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:1rem;
    }
    .modal-close {
      background:none;
      border:none;
      font-size:1.25rem;
      color:var(--text);
      cursor:pointer;
    }

    /* Upload Modal specifics */
    .upload-modal {
      width:400px;
      max-width:90%;
    }
    .upload-modal h2 {
      margin:0 0 1rem;
      font-size:1.25rem;
    }
    .drop-zone {
      border:2px dashed var(--muted);
      border-radius:8px;
      padding:2rem;
      text-align:center;
      color:var(--muted);
      cursor:pointer;
      transition:background .2s,border-color .2s;
    }
    .drop-zone.dragover {
      border-color:var(--primary);
      background:rgba(41,121,255,0.05);
    }
    .modal-file-list {
      list-style:none;
      margin-top:1rem;
      padding:0;
      max-height:8rem;
      overflow-y:auto;
    }
    .modal-file-list li {
      background:var(--card-bg);
      padding:.75rem 1rem;
      border-radius:6px;
      margin-bottom:.5rem;
      font-size:.9rem;
      position:relative;
    }
    .modal-file-list li .size {
      position:absolute;
      top:.75rem;
      right:1rem;
      color:var(--muted);
      font-size:.85rem;
    }
    .modal-file-list li .tag-input {
      display:block;
      width:100%;
      margin-top:.75rem;
      padding:.5rem;
      border-radius:4px;
      border:1px solid var(--muted);
      background:var(--bg);
      color:var(--text);
      font-size:.9rem;
    }
    .modal-actions {
      display:flex;
      justify-content:flex-end;
      gap:1rem;
      margin-top:1.5rem;
    }
    .btn-modal-cancel {
      background:none;
      border:none;
      color:var(--text);
      font-size:.95rem;
      cursor:pointer;
    }
    .btn-modal-upload {
      background:var(--primary);
      border:none;
      color:#fff;
      padding:.5rem 1rem;
      border-radius:4px;
      font-size:.95rem;
      cursor:pointer;
    }
    .btn-modal-upload:disabled {
      opacity:.5;
      cursor:not-allowed;
    }

    /* Settings Modal */
    .settings-modal {
      width:320px;
      max-width:90%;
    }
    .settings-profile {
      margin-bottom:1rem;
    }
    .settings-profile strong {
      font-size:1.1rem;
    }
    .settings-profile .email {
      display:block;
      color:var(--muted);
      font-size:.9rem;
    }
    .settings-divider {
      border:none;
      height:1px;
      background:rgba(255,255,255,0.1);
      margin:1rem 0;
    }
    .settings-stats div {
      margin-bottom:.75rem;
      font-size:.95rem;
    }
    .logout-btn {
      width:100%;
      border:1px solid var(--muted);
      background:none;
      color:var(--muted);
      padding:.5rem;
      border-radius:6px;
      cursor:pointer;
      font-size:.95rem;
      transition:background .2s,color .2s,border .2s;
    }
    .logout-btn:hover {
      background:var(--text);
      color:var(--bg);
      border-color:var(--text);
    }

    /* Document Viewer */
    .doc-viewer .modal {
      width:80%;
      max-width:800px;
      padding:0;
      overflow:hidden;
    }
    .doc-viewer iframe {
      width:100%;
      height:80vh;
      border:none;
    }

    /* =======================
       ADMIN TABLE
       ======================= */
    .admin-table {
      width:100%;
      border-collapse: collapse;
      margin-top:1rem;
    }
    .admin-table th,
    .admin-table td {
      padding:.75rem;
      border:1px solid rgba(255,255,255,0.1);
      text-align:left;
      font-size:.9rem;
    }
    .admin-table th {
      background:rgba(255,255,255,0.05);
    }
    .admin-section h3 {
      margin-bottom:1rem;
      font-size:1.2rem;
    }

  </style>
</head>
<body>

  <div class="container">
    <!-- HEADER -->
    <div class="header">
      <div class="header-left">
        <i class="fas fa-cloud"></i>
        <h1>TaxFlows<span>AI</span></h1>
      </div>
      <div class="header-right">
        <button id="settingsBtn">
          <i class="fas fa-cog"></i>
        </button>
      </div>
    </div>
    <hr class="divider"/>

    <!-- TOP -->
    <div class="top">
      <div>
        <div class="greeting">Welcome, …</div>
        <div class="subtext">You’re part of the … network</div>
      </div>
      <div class="progress-tabs">
        <span data-status="uploaded" class="active">Uploaded</span>
        <span data-status="review">In Review</span>
        <span data-status="filed">Filed</span>
        <div class="progress-bar"></div>
      </div>
      <button id="openUploadBtn" class="btn-open-upload">Upload Document</button>
    </div>

    <!-- DASHBOARD CONTENT -->
    <div id="clientView">
      <div class="grid">
        <div class="card">
          <h3>Documents Uploaded</h3>
          <ul class="doc-list"></ul>
        </div>
        <div class="card">
          <h3>Notifications</h3>
          <div class="no-notifs">No new notifications</div>
        </div>
        <div class="card">
          <div class="chat-icon"><i class="fas fa-comments"></i></div>
          <h3 style="text-align:center;margin-bottom:1rem;">AI Chat</h3>
          <ul class="chat-quick">
            <li><a href="#">What’s the status of my refund?</a></li>
            <li><a href="#">How do I upload a 1099?</a></li>
          </ul>
          <div class="chat-input">
            <input type="text" placeholder="Ask anything…"/>
            <button>Chat</button>
          </div>
        </div>
      </div>
    </div>


  </div>

  <!-- UPLOAD MODAL -->
  <div id="uploadModal" class="modal-overlay hidden">
    <div class="modal upload-modal">
      <div class="modal-header">
        <h2>Upload Document</h2>
        <button id="closeUploadModal" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div id="uploadDropZone" class="drop-zone">
          <p>Drag &amp; drop files here, or click to choose</p>
          <input type="file" id="uploadInput" multiple hidden/>
        </div>
        <ul id="modalFileList" class="modal-file-list"></ul>
      </div>
      <div class="modal-actions">
        <button id="cancelUploadBtn" class="btn-modal-cancel">Cancel</button>
        <button id="confirmUploadBtn" class="btn-modal-upload" disabled>Upload</button>
      </div>
    </div>
  </div>

  <!-- SETTINGS MODAL -->
  <div id="settingsModal" class="modal-overlay hidden">
    <div class="modal settings-modal">
      <div class="modal-header">
        <h2>Settings</h2>
        <button id="closeSettingsModal" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="settings-profile">
          <strong id="profileName">…</strong>
          <span class="email" id="profileEmail">…</span>
          <span class="email" id="profilePartner">…</span>
        </div>
        <hr class="settings-divider"/>
        <div class="settings-stats">
          <div>Uploaded: <span id="stat-uploaded">0</span></div>
          <div>In Review: <span id="stat-review">0</span></div>
          <div>Filed: <span id="stat-filed">0</span></div>
        </div>
        <div style="margin-top:1rem;">
          <button id="logoutBtn" class="logout-btn">Logout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- DOC VIEWER MODAL -->
  <div id="viewModal" class="modal-overlay hidden doc-viewer">
    <div class="modal">
      <iframe id="docIframe" src=""></iframe>
    </div>
  </div>

  <script>
    // =======================
    // AUTH GUARD & PROFILE
    // =======================
    const CURRENT = localStorage.getItem('currentUser');
    if (!CURRENT) location.replace('taxflowsai-login.html');
    const me     = JSON.parse(localStorage.getItem('user_' + CURRENT));
    // Greeting + subtext
    document.querySelector('.greeting').textContent = 'Welcome, ' + me.name;
    document.querySelector('.subtext').textContent  =
      me.role === 'client'
        ? `You’re part of the ${me.partner} network.`
        : `You’re an Admin.`;
    // Settings modal profile
    document.getElementById('profileName').textContent    = me.name;
    document.getElementById('profileEmail').textContent   = me.email;
    document.getElementById('profilePartner').textContent = me.role === 'client'
      ? `Partner: ${me.partner}`
      : '';

    // Show client vs admin section
    const clientView = document.getElementById('clientView');
    const adminView  = document.getElementById('adminView');
    

    // =======================
    // DATA STRUCTURES
    // =======================
    // Keep docsData in memory; could persist per user later
    const docsData = {
      uploaded: [],
      review: [],
      filed: []
    };

    // =======================
    // ELEMENT REFERENCES
    // =======================
    const tabs          = document.querySelectorAll('.progress-tabs span');
    const bar           = document.querySelector('.progress-bar');
    const docList       = document.querySelector('.doc-list');
    const openUpBtn     = document.getElementById('openUploadBtn');
    const uploadMd      = document.getElementById('uploadModal');
    const closeUp       = document.getElementById('closeUploadModal');
    const cancelUp      = document.getElementById('cancelUploadBtn');
    const confirmUp     = document.getElementById('confirmUploadBtn');
    const dropZone      = document.getElementById('uploadDropZone');
    const fileIn        = document.getElementById('uploadInput');
    const modalFileList = document.getElementById('modalFileList');
    const settingsBtn   = document.getElementById('settingsBtn');
    const settingsMd    = document.getElementById('settingsModal');
    const closeSet      = document.getElementById('closeSettingsModal');
    const logoutBtn     = document.getElementById('logoutBtn');
    const statUp        = document.getElementById('stat-uploaded');
    const statRev       = document.getElementById('stat-review');
    const statFile      = document.getElementById('stat-filed');
    const viewMd        = document.getElementById('viewModal');
    const docIframe     = document.getElementById('docIframe');
    const adminTbody    = document.getElementById('adminTableBody');

    let currentStatus = 'uploaded';
    let selectedFiles = [];

    // =======================
    // HELPER: format bytes
    // =======================
    function fmtSize(b) {
      if (b < 1024) return b + ' B';
      if (b < 1024**2) return (b/1024).toFixed(1) + ' KB';
      return (b/1024**2).toFixed(1) + ' MB';
    }

    // =======================
    // RENDER FUNCTIONS
    // =======================
    function renderDocs() {
      docList.innerHTML = '';
      docsData[currentStatus].forEach(d => {
        const li = document.createElement('li');
        li.innerHTML = `
          <i class="fas fa-file-alt"></i>
          <div style="flex:1">
            <strong>${d.name}</strong><br>
            <small style="color:var(--muted)">${d.desc}</small>
            ${d.tags && d.tags.length
              ? `<div class="tag-list">
                   ${d.tags.map(t=>`<span class="tag">${t}</span>`).join('')}
                 </div>`
              : ''}
          </div>
        `;
        li.addEventListener('click', () => openViewer(d.url));
        docList.appendChild(li);
      });
    }

    function updateStats() {
      statUp.textContent = docsData.uploaded.length;
      statRev.textContent = docsData.review.length;
      statFile.textContent= docsData.filed.length;
    }

    function renderAdminTable() {
      adminTbody.innerHTML = '';
      // iterate all localStorage keys
      Object.keys(localStorage).forEach(k => {
        if (!k.startsWith('user_')) return;
        const u = JSON.parse(localStorage.getItem(k));
        if (u.role !== 'client') return;
        // count their docs
        const count = docsData.uploaded.length;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.role}</td>
          <td>${u.partner}</td>
          <td>${count}</td>
        `;
        adminTbody.appendChild(tr);
      });
    }

    // =======================
    // TABS LOGIC
    // =======================
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        currentStatus = tab.dataset.status;
        moveBar(tab);
        renderDocs();
      });
    });
    function moveBar(tab) {
      const {offsetWidth:w,offsetLeft:x} = tab;
      bar.style.width = w + 'px';
      bar.style.left  = x + 'px';
    }
    // init tabs
    moveBar(document.querySelector('.progress-tabs span.active'));
    renderDocs();

    // =======================
    // UPLOAD MODAL
    // =======================
    function renderModalList() {
      modalFileList.innerHTML = '';
      selectedFiles.forEach((f,i) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${f.name}</span>
          <span class="size">${fmtSize(f.size)}</span>
          <input type="text"
                 class="tag-input"
                 placeholder="Tags (comma separated)"
                 data-index="${i}" />
        `;
        modalFileList.appendChild(li);
      });
    }

    openUploadBtn.addEventListener('click', () => uploadMd.classList.remove('hidden'));
    closeUp.addEventListener('click',      () => { uploadMd.classList.add('hidden'); resetUpload(); });
    cancelUp.addEventListener('click',     () => { uploadMd.classList.add('hidden'); resetUpload(); });

    ['dragenter','dragover'].forEach(ev =>
      dropZone.addEventListener(ev, e => {
        e.preventDefault();
        dropZone.classList.add('dragover');
      })
    );
    ['dragleave','drop'].forEach(ev =>
      dropZone.addEventListener(ev, e => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
      })
    );
    dropZone.addEventListener('drop', e => {
      selectedFiles = Array.from(e.dataTransfer.files);
      fileIn.files = e.dataTransfer.files;
      renderModalList();
      confirmUp.disabled = selectedFiles.length === 0;
    });
    dropZone.addEventListener('click', () => fileIn.click());
    fileIn.addEventListener('change', () => {
      selectedFiles = Array.from(fileIn.files);
      renderModalList();
      confirmUp.disabled = selectedFiles.length === 0;
    });

    confirmUp.addEventListener('click', () => {
      selectedFiles.forEach((file,i) => {
        const url = URL.createObjectURL(file);
        const input = document.querySelector(`.tag-input[data-index="${i}"]`);
        const tags = input && input.value
          ? input.value.split(',').map(s=>s.trim()).filter(Boolean)
          : [];
        docsData.uploaded.push({
          name: file.name,
          desc: file.name,
          url,
          tags
        });
      });
      uploadMd.classList.add('hidden');
      resetUpload();
      if (currentStatus === 'uploaded') renderDocs();
      updateStats();
      if (me.role === 'admin') renderAdminTable();
    });

    function resetUpload() {
      selectedFiles = [];
      fileIn.value = '';
      modalFileList.innerHTML = '';
      confirmUp.disabled = true;
    }

    // =======================
    // SETTINGS & LOGOUT
    // =======================
    settingsBtn.addEventListener('click', () => {
      updateStats();
      if (me.role === 'admin') renderAdminTable();
      settingsMd.classList.remove('hidden');
    });
    closeSet.addEventListener('click', () => settingsMd.classList.add('hidden'));
    settingsMd.addEventListener('click', e => {
      if (e.target === settingsMd) settingsMd.classList.add('hidden');
    });
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('currentUser');
      location.replace('taxflowsai-login.html');
    });

    // =======================
    // DOCUMENT VIEWER
    // =======================
    function openViewer(src) {
      docIframe.src = src;
      viewMd.classList.remove('hidden');
    }
    viewMd.addEventListener('click', e => {
      if (e.target === viewMd) viewMd.classList.add('hidden');
    });
  </script>
</body>
</html>
